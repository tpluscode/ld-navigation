{"version":3,"file":"ld-navigation.js","sources":["src/LdNavigator.ts","src/LdNavigation.ts","src/ld-link.ts","src/ld-navigator.ts"],"sourcesContent":["    class LdNavigator {\n        private _base: string = '';\n        clientBasePath: string = '';\n        useHashFragment: boolean = false;\n\n        get base() {\n            return this._base;\n        }\n\n        set base(url:string) {\n            if (url && url.replace) {\n                url = url.replace(new RegExp('/$'), '');\n            }\n\n            this._base = url || '';\n        }\n\n        get resourcePath(): string {\n            const path = (this.useHashFragment\n                ? document.location.hash.substr(1, document.location.hash.length - 1)\n                : document.location.pathname).replace(/^\\//, '');\n\n            if(this.clientBasePath) {\n                return path.replace(new RegExp('^' + this.clientBasePath + '\\/'), '');\n            }\n\n            return path;\n        }\n\n        get statePath() {\n            return this.resourcePath;\n        }\n\n        get resourceUrl():string {\n            const path = this.resourcePath;\n\n            if (/^http:\\/\\//.test(path)) {\n                return path + document.location.search;\n            } else {\n                return this.base + '/' + path + document.location.search;\n            }\n        }\n\n        getStatePath(absoluteUrl: string): string {\n\n            let resourcePath = absoluteUrl.replace(new RegExp('^' + this.base), '');\n\n            if(resourcePath[0] !== '/') {\n                resourcePath = '/' + resourcePath;\n            }\n\n            if(this.clientBasePath && this.useHashFragment === false) {\n                return '/' + this.clientBasePath + resourcePath;\n            }\n\n            return resourcePath;\n        }\n\n        private _resourceUrlMatchesBase(absoluteUrl: string): boolean {\n            return !!this.base && !!absoluteUrl.match('^' + this.base);\n        }\n    }\n\n    export default new LdNavigator();\n","export default class Helpers {\n    static fireNavigation(dispatcher:EventTarget, resourceUrl:string) {\n        dispatcher.dispatchEvent(new CustomEvent('ld-navigated', {\n            detail: {\n                resourceUrl: resourceUrl\n            },\n            bubbles: true\n        }));\n    }\n}\n","import LdNavigator from './LdNavigator';\nimport Helpers from './LdNavigation';\n\nconst resourceUrlAttrName = 'resource-url';\n\nclass LinkedDataLink extends HTMLElement {\n    private _resourceUrl:string;\n\n    constructor() {\n        super();\n\n        if (this.hasAttribute(resourceUrlAttrName)) {\n            this.resourceUrl = this.getAttribute(resourceUrlAttrName);\n        }\n\n        if(this._anchor) {\n            this._anchor.addEventListener('click', navigate.bind(this));\n        } else {\n            this.addEventListener('click', navigate.bind(this));\n        }\n    }\n\n    static get observedAttributes() {\n        return [\n            resourceUrlAttrName\n        ];\n    }\n\n    get resourceUrl():string {\n        return this._resourceUrl;\n    }\n\n    set resourceUrl(url:string) {\n        this._resourceUrl = url;\n\n        this.removeAttribute('href');\n\n        if(this._anchor) {\n            this._setLink();\n        }\n    }\n\n    private get _anchor(): HTMLAnchorElement {\n        return this.querySelector('a');\n    }\n\n    attributeChangedCallback(attr, oldVal, newVal) {\n        if (attr === resourceUrlAttrName) {\n            this.resourceUrl = newVal;\n        }\n    }\n\n    private _setLink() {\n        if(this.resourceUrl) {\n            const state = LdNavigator.getStatePath(this.resourceUrl);\n\n            if (LdNavigator.useHashFragment) {\n                this._anchor.href = '#' + state;\n            } else {\n                this._anchor.href = state;\n            }\n        } else {\n            this._anchor.removeAttribute('href');\n        }\n    }\n}\n\nfunction navigate(e: Event) {\n    Helpers.fireNavigation(this, this.resourceUrl);\n    e.preventDefault();\n}\n\nwindow.customElements.define('ld-link',  LinkedDataLink);\n","/// <reference path=\"LdNavigation.ts\" />\n\nimport LdNavigator from './LdNavigator';\n\nclass LdNavigatorElement extends HTMLElement {\n    private _handlers;\n\n    connectedCallback() {\n        this._handlers = [];\n\n        this._handlers.push({ event: 'ld-navigated', handler: this._handleNavigation.bind(this) });\n        this._handlers.push({ event: 'popstate', handler: this._navigateOnPopstate.bind(this) });\n        this._handlers.push({ event: 'hashchange', handler: this._notifyOnHashchange.bind(this) });\n\n        this._handlers.forEach(h => {\n            window.addEventListener(h.event, h.handler);\n        });\n\n        notifyResourceUrlChanged(this);\n    }\n\n    constructor() {\n        super();\n\n        this.base = this.getAttribute('base');\n        this.clientBasePath = this.getAttribute('client-base-path');\n        LdNavigator.useHashFragment = this.getAttribute('use-hash-fragment') !== null;\n\n        if (!(window.history && window.history.pushState)) {\n            this.useHashFragment = true;\n        }\n    }\n\n    static get observedAttributes() {\n        return [\n            'base',\n            'client-base-path',\n            'use-hash-fragment'\n        ]\n    }\n\n    disconnectedCallback() {\n        this._handlers.forEach(h => {\n            window.removeEventListener(h.event, h.handler);\n        });\n    }\n\n    attributeChangedCallback(attr, oldVal, newVal) {\n        switch(attr) {\n            case 'base':\n                this.base = newVal;\n                break;\n            case 'client-base-path':\n                this.clientBasePath = newVal;\n                break;\n            case 'use-hash-fragment':\n                LdNavigator.useHashFragment = newVal !== null;\n                break;\n        }\n    }\n\n    get resourceUrl():string {\n        return LdNavigator.resourceUrl;\n    }\n\n    get resourcePath(): string {\n        return LdNavigator.resourcePath;\n    }\n\n    get statePath() {\n        return LdNavigator.statePath;\n    }\n\n    get base(): string {\n        return LdNavigator.base;\n    }\n\n    set base(url:string) {\n        LdNavigator.base = url;\n    }\n\n    get clientBasePath(): string{\n        return LdNavigator.clientBasePath;\n    }\n\n    set clientBasePath(clientBasePath: string) {\n        LdNavigator.clientBasePath = clientBasePath || '';\n    }\n\n    get useHashFragment(): boolean {\n        return LdNavigator.useHashFragment;\n    }\n\n    set useHashFragment(useHash: boolean) {\n        if(useHash) {\n            this.setAttribute('use-hash-fragment', '');\n        } else{\n            this.removeAttribute('use-hash-fragment');\n        }\n    }\n\n    private _handleNavigation(e: CustomEvent) {\n        let prevUrl = this.resourceUrl;\n\n        if (this.useHashFragment) {\n            document.location.hash = LdNavigator.getStatePath(e.detail.resourceUrl);\n        } else if (e.detail.resourceUrl !== history.state) {\n            history.pushState(e.detail.resourceUrl, '', LdNavigator.getStatePath(e.detail.resourceUrl));\n        }\n\n        if(prevUrl !== this.resourceUrl){\n            notifyResourceUrlChanged(this);\n        }\n    }\n\n    private _navigateOnPopstate() {\n        if (this.useHashFragment === false) {\n            notifyResourceUrlChanged(this);\n        }\n    }\n\n    private _notifyOnHashchange() {\n        if (this.useHashFragment) {\n            notifyResourceUrlChanged(this);\n        }\n    }\n}\n\nfunction notifyResourceUrlChanged(elem: LdNavigatorElement) {\n    elem.dispatchEvent(new CustomEvent('resource-url-changed', {\n        detail: {\n            value: elem.resourceUrl\n        }\n    }));\n}\n\nwindow.customElements.define('ld-navigator', LdNavigatorElement);\n"],"names":["LdNavigator"],"mappings":"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"}