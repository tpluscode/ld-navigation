<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ld-link-tests</title>
    <script src="../bower_components/webcomponentsjs/webcomponents.min.js"></script>
    <script src="../bower_components/web-component-tester/browser.js"></script>
    <link rel="import" href="../ld-navigation.html">
</head>
<body>
    <ld-navigator></ld-navigator>
    <test-fixture id="no-resource-url">
        <template>
            <ld-link></ld-link>
        </template>
    </test-fixture>
    <test-fixture id="has-resource-url">
        <template>
            <ld-link resource-url="http://example.com/some/path"></ld-link>
        </template>
    </test-fixture>

    <script>
        var ldLink, ldNavigator;

        describe('<ld-link>', function () {

            beforeEach(function () {
                ldLink = fixture('no-resource-url');
            });

            it('renders no link', function () {
                assert.isNull(ldLink.querySelector('a'));
            });

        });

        describe('<ld-link resource-url="http://example.com/some/path">', function () {

            beforeEach(function () {
                ldNavigator = document.querySelector('ld-navigator');
            });

            describe('without base', function(){

                beforeEach(function () {
                    ldNavigator.base = '';
                    ldLink = fixture('has-resource-url');
                });

                it('renders absolute href link', function () {

                    assert.equal(ldLink.querySelector('a').getAttribute('href'), '/http://example.com/some/path');
                });

                it('when clicked, triggers navigation', function(done) {

                    window.addEventListener('ld-navigated', function(e) {
                        assert.equal(e.detail.resourceUrl, ldLink.resourceUrl);
                        done();
                    });

                    ldLink.click();
                });
            });

            describe('with base', function() {
                beforeEach(function () {
                    ldNavigator.base = 'http://example.com';
                    ldLink = fixture('has-resource-url');
                });

                it('renders relative href link', function () {

                    assert.equal(ldLink.querySelector('a').getAttribute('href'), '/some/path');
                });
            });

            describe('with base and client-base-path', function() {
                beforeEach(function () {
                    ldNavigator.base = 'http://example.com';
                    ldNavigator.clientBasePath = 'some/base';
                    ldLink = fixture('has-resource-url');
                });

                it('renders relative href link with client base prepended', function () {

                    assert.equal(ldLink.querySelector('a').getAttribute('href'), '/some/base/some/path');
                });
            });

            describe('without base, using hash fragment', function(){

                beforeEach(function () {
                    ldNavigator.base = '';
                    ldNavigator.useHashFragment = true;
                    ldLink = fixture('has-resource-url');
                });

                it('renders absolute href link', function () {

                    assert.equal(ldLink.querySelector('a').getAttribute('href'), '#http://example.com/some/path');
                });
            });

            describe('with base, using hash fragment', function() {
                beforeEach(function () {
                    ldNavigator.base = 'http://example.com';
                    ldNavigator.useHashFragment = true;
                    ldLink = fixture('has-resource-url');
                });

                it('renders relative href link', function () {

                    assert.equal(ldLink.querySelector('a').getAttribute('href'), '#/some/path');
                });
            });

            describe('with base and client-base-path, using hash fragment', function() {
                beforeEach(function () {
                    ldNavigator.base = 'http://example.com';
                    ldNavigator.clientBasePath = 'some/base';
                    ldNavigator.useHashFragment = true;
                    ldLink = fixture('has-resource-url');
                });

                it('renders relative href link', function () {

                    assert.equal(ldLink.querySelector('a').getAttribute('href'), '#/some/path');
                });
            });
        });

    </script>
</body>
</html>