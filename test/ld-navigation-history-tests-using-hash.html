<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <script src="../bower_components/webcomponentsjs/webcomponents.min.js"></script>
    <script src="../bower_components/web-component-tester/browser.js"></script>
    <script src="event-helper.js"></script>
    <link rel="import" href="../ld-navigation.html">
</head>
<body>

<test-fixture id="HistoryElementUsingHash">
    <template>
        <ld-navigator use-hash-fragment></ld-navigator>
    </template>
</test-fixture>

<test-fixture id="HistoryElementWithBaseUsingHashFixture">
    <template>
        <ld-navigator use-hash-fragment base="http://base.example.org"></ld-navigator>
    </template>
</test-fixture>

<script>
    var elem;

    describe('<ld-navigator use-hash-fragment>', function() {

        beforeEach(function(){
            elem = fixture('HistoryElementUsingHash');
        });

        it('should set URL hash when ld-navigated event occurs', function(done) {

            testHandler(window, 'ld-navigated', function() {
                assert.equal(location.hash, '#http://example.org/hash/path');
                done();
            });

            LdNavigation.Helpers.fireNavigation(document, 'http://example.org/hash/path');
        });

        it('should change resourceUrl on hashchange event', function(done) {

            testHandler(elem, 'resource-url-changed', function(e) {
                assert.equal(e.detail.value, 'http://example.org/explicit/path');
                assert.equal(elem.resourceUrl, 'http://example.org/explicit/path');
                done();
            });

            document.location.hash = 'http://example.org/explicit/path';
        });
    });

    describe('<ld-navigator use-hash-fragment base="">', function() {

        beforeEach(function(){
            elem = fixture('HistoryElementWithBaseUsingHashFixture');
        });

        it('should push relative URL state when ld-navigated event occurs', function(done) {

            testHandler(window, 'hashchange', function() {
              assert.equal(location.hash, '#/some/other/path');
              done();
            });

            LdNavigation.Helpers.fireNavigation(document, 'http://base.example.org/some/other/path');
        });
    });
</script>
</body>
</html>