<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <script src="../bower_components/webcomponentsjs/webcomponents.min.js"></script>
    <script src="../bower_components/web-component-tester/browser.js"></script>
    <link rel="import" href="../ld-html5-history.html">
</head>
<body>
<test-fixture id="EmptyHistoryElementFixture">
    <template>
        <ld-html5-history></ld-html5-history>
    </template>
</test-fixture>

<test-fixture id="HistoryElementWithBaseUrlFixture">
    <template>
        <ld-html5-history base-url="http://example.org"></ld-html5-history>
    </template>
</test-fixture>

<script>
    var elem;

    describe('<ld-html5-history>', function () {

        beforeEach(function(){
            elem = fixture('EmptyHistoryElementFixture');
        });

        it('has empty base URL', function () {
            assert.equal(elem.baseUrl, '');
        });

        describe('when setting base URL property', function(){

            beforeEach(function() {
                elem.baseURI = 'http://example.org/';
            });

            it('doesn\'t set attribute', function(){
                assert.isNull(elem.getAttribute('base-url'));
            });

        });

        describe('when setting base URL attribute', function(){

            beforeEach(function() {
                elem.setAttribute('base-url', 'http://example.org/');
            });

            it('has property set', function(){
                assert.equal(elem.baseUrl, 'http://example.org/');
            });

        });

        describe('when setting base URL property with URL not ending in slash', function(){

            beforeEach(function() {
                elem.baseUrl = 'http://example.org';
            });

            it('should append slash to value', function(){
                assert.equal(elem.baseUrl, 'http://example.org/');
            });

        });

        describe('when pushing state', function() {

            var path = '/example/path';

            beforeEach(function() {
               history.pushState(path, '', path);
            });

            it('should have resource url pointing to the relative path', function() {
                assert.equal(elem.resourceUrl, path);
            });

        });
    });

    describe('<ld-html5-history base-url="http://example.org">', function () {

        beforeEach(function(){
            elem = fixture('HistoryElementWithBaseUrlFixture');
        });

        describe('when pushing state', function() {

            var path = '/example/path';

            beforeEach(function() {
                history.pushState(path, '', path);
            });

            it('should have resource url pointing to the pushed path', function() {
                assert.equal(elem.resourceUrl, 'http://example.org/example/path');
            });

            describe('and pushing again', function(){

                beforeEach(function() {
                    history.pushState('/example/path2', '', '/example/path2');
                });

                it('should have resource url pointing to the correct path', function() {
                    assert.equal(elem.resourceUrl, 'http://example.org/example/path2');
                });

                describe('and then popping', function(){

                    beforeEach(function() {
                        history.go(-1);
                    });

                    it('should have resource url pointing to the previous path', function() {
                        assert.equal(elem.resourceUrl, 'http://example.org/example/path');
                    });

                });

            });

        });
    });
</script>
</body>
</html>