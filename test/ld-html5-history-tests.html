<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <script src="../bower_components/webcomponentsjs/webcomponents.min.js"></script>
    <script src="../bower_components/web-component-tester/browser.js"></script>
    <link rel="import" href="../ld-navigation.html">
</head>
<body>
<test-fixture id="EmptyHistoryElementFixture">
    <template>
        <ld-html5-history></ld-html5-history>
    </template>
</test-fixture>

<test-fixture id="HistoryElementWithBaseUrlFixture">
    <template>
        <script>
            LdNavigation.Context.base = 'http://example.org';
        </script>

        <ld-html5-history></ld-html5-history>
    </template>
</test-fixture>

<script>
    var elem;

    describe('<ld-html5-history>', function () {

        beforeEach(function(){
            elem = fixture('EmptyHistoryElementFixture');
        });

        it('should push absolute URL state when ld-navigated event occurs', function(done) {

            window.addEventListener('ld-navigated', function(e) {
                assert.equal(location.pathname, '/http://example.org/some/path');
                done();
            });

            document.dispatchEvent(new CustomEvent('ld-navigated', {
                detail: {
                    resourceUrl: 'http://example.org/some/path'
                },
                bubbles: true
            }))
        });

    });

    describe('<ld-html5-history> with base', function () {

        beforeEach(function(){
            elem = fixture('HistoryElementWithBaseUrlFixture')[1];
        });

        it('should push relative URL state when ld-navigated event occurs', function(done) {

            window.addEventListener('ld-navigated', function(e) {
                assert.equal(location.pathname, '/some/path');
                done();
            });

            document.dispatchEvent(new CustomEvent('ld-navigated', {
                detail: {
                    resourceUrl: 'http://example.org/some/path'
                },
                bubbles: true
            }))
        });

//        describe('when pushing state', function() {
//
//            var path = '/example/path';
//
//            beforeEach(function() {
//                history.pushState(path, '', path);
//            });
//
//            it('should have resource url pointing to the pushed path', function() {
//                assert.equal(elem.resourceUrl, 'http://example.org/example/path');
//            });
//
//            describe('and pushing again', function(){
//
//                beforeEach(function() {
//                    history.pushState('/example/path2', '', '/example/path2');
//                });
//
//                it('should have resource url pointing to the correct path', function() {
//                    assert.equal(elem.resourceUrl, 'http://example.org/example/path2');
//                });
//
//                describe('and then popping', function(){
//
//                    beforeEach(function() {
//                        history.go(-1);
//                    });
//
//                    it('should have resource url pointing to the previous path', function() {
//                        assert.equal(elem.resourceUrl, 'http://example.org/example/path');
//                    });
//
//                });
//
//            });

//        });
    });
</script>
</body>
</html>